<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BRUTE Search - Select URLs to Scrape</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
      }

      .header h1 {
        font-size: 28px;
        margin-bottom: 10px;
      }

      .header .query {
        font-size: 16px;
        opacity: 0.9;
        font-weight: 500;
      }

      .stats {
        display: flex;
        gap: 20px;
        margin-top: 15px;
        flex-wrap: wrap;
      }

      .stat {
        background: rgba(255, 255, 255, 0.2);
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
      }

      .stat strong {
        font-size: 18px;
        display: block;
      }

      .controls {
        padding: 20px 30px;
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .control-group {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      button {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .btn-success {
        background: #28a745;
        color: white;
        font-size: 16px;
        padding: 12px 30px;
      }

      .btn-success:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
      }

      .btn-success:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .search-box {
        flex: 1;
        min-width: 300px;
      }

      .search-box input {
        width: 100%;
        padding: 10px 15px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.2s;
      }

      .search-box input:focus {
        outline: none;
        border-color: #667eea;
      }

      .url-list {
        padding: 20px 30px;
        max-height: 60vh;
        overflow-y: auto;
      }

      .url-item {
        padding: 15px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        margin-bottom: 10px;
        transition: all 0.2s;
        cursor: pointer;
        display: flex;
        gap: 15px;
        align-items: start;
      }

      .url-item:hover {
        border-color: #667eea;
        background: #f8f9ff;
      }

      .url-item.selected {
        background: #e7eaff;
        border-color: #667eea;
      }

      .url-item.hidden {
        display: none;
      }

      .checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
        flex-shrink: 0;
        margin-top: 2px;
      }

      .url-content {
        flex: 1;
        min-width: 0;
      }

      .url-title {
        font-weight: 600;
        font-size: 16px;
        color: #2d3748;
        margin-bottom: 5px;
        word-wrap: break-word;
      }

      .url-link {
        color: #667eea;
        font-size: 14px;
        text-decoration: none;
        display: block;
        margin-bottom: 5px;
        word-break: break-all;
      }

      .url-link:hover {
        text-decoration: underline;
      }

      .url-snippet {
        color: #6c757d;
        font-size: 13px;
        line-height: 1.5;
        margin-top: 8px;
      }

      .selected-count {
        background: #667eea;
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
      }

      .footer {
        padding: 20px 30px;
        background: #f8f9fa;
        border-top: 1px solid #e9ecef;
        text-align: center;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 40px;
        color: #6c757d;
      }

      .loading.active {
        display: block;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ðŸ”¥ BRUTE Search Results</h1>
        <div class="query">Query: <strong id="search-query"></strong></div>
        <div class="stats">
          <div class="stat">
            <strong id="total-urls">0</strong>
            Total URLs
          </div>
          <div class="stat">
            <strong id="selected-urls">0</strong>
            Selected
          </div>
          <div class="stat">
            <strong>Level <span id="search-level">2</span></strong>
            Search Depth
          </div>
        </div>
      </div>

      <div class="controls">
        <div class="control-group">
          <button class="btn-secondary" onclick="selectAll()">
            Select All
          </button>
          <button class="btn-secondary" onclick="selectNone()">
            Select None
          </button>
          <button class="btn-secondary" onclick="invertSelection()">
            Invert
          </button>
        </div>

        <div class="search-box">
          <input
            type="text"
            id="filter-input"
            placeholder="Filter URLs (by title, URL, or snippet)..."
            oninput="filterUrls()"
          />
        </div>

        <div class="control-group">
          <span class="selected-count" id="selected-count">0 selected</span>
        </div>
      </div>

      <div class="url-list" id="url-list">
        <!-- URLs will be populated here -->
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Scraping selected URLs...</div>
      </div>

      <div class="footer">
        <button
          class="btn-success"
          id="scrape-btn"
          onclick="scrapeSelected()"
          disabled
        >
          Scrape Selected URLs with Firecrawl
        </button>
      </div>
    </div>

    <script>
      let allUrls = [];
      let searchData = {};

      // Load data from URL parameters (passed by MCP server)
      function loadData() {
        const params = new URLSearchParams(window.location.search);
        const dataParam = params.get("data");

        if (dataParam) {
          try {
            searchData = JSON.parse(decodeURIComponent(dataParam));
            allUrls = searchData.results || [];

            document.getElementById("search-query").textContent =
              searchData.query || "Unknown";
            document.getElementById("search-level").textContent =
              searchData.level || "2";
            document.getElementById("total-urls").textContent = allUrls.length;

            renderUrls();
          } catch (e) {
            console.error("Failed to parse data:", e);
            alert("Failed to load search results");
          }
        }
      }

      function renderUrls() {
        const container = document.getElementById("url-list");
        container.innerHTML = "";

        allUrls.forEach((result, index) => {
          const div = document.createElement("div");
          div.className = "url-item";
          div.dataset.index = index;
          div.onclick = e => {
            if (e.target.type !== "checkbox") {
              toggleUrl(index);
            }
          };

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "checkbox";
          checkbox.id = `url-${index}`;
          checkbox.onchange = () => toggleUrl(index);

          const content = document.createElement("div");
          content.className = "url-content";

          const title = document.createElement("div");
          title.className = "url-title";
          title.textContent = result.title || "No title";

          const link = document.createElement("a");
          link.className = "url-link";
          link.href = result.url;
          link.target = "_blank";
          link.textContent = result.url;
          link.onclick = e => e.stopPropagation();

          const snippet = document.createElement("div");
          snippet.className = "url-snippet";
          snippet.textContent = result.snippet || "No snippet available";

          content.appendChild(title);
          content.appendChild(link);
          content.appendChild(snippet);

          div.appendChild(checkbox);
          div.appendChild(content);

          container.appendChild(div);
        });

        updateSelectedCount();
      }

      function toggleUrl(index) {
        const checkbox = document.getElementById(`url-${index}`);
        checkbox.checked = !checkbox.checked;

        const item = checkbox.closest(".url-item");
        if (checkbox.checked) {
          item.classList.add("selected");
        } else {
          item.classList.remove("selected");
        }

        updateSelectedCount();
      }

      function selectAll() {
        document
          .querySelectorAll(".url-item:not(.hidden) .checkbox")
          .forEach(cb => {
            cb.checked = true;
            cb.closest(".url-item").classList.add("selected");
          });
        updateSelectedCount();
      }

      function selectNone() {
        document.querySelectorAll(".checkbox").forEach(cb => {
          cb.checked = false;
          cb.closest(".url-item").classList.remove("selected");
        });
        updateSelectedCount();
      }

      function invertSelection() {
        document
          .querySelectorAll(".url-item:not(.hidden) .checkbox")
          .forEach(cb => {
            cb.checked = !cb.checked;
            const item = cb.closest(".url-item");
            if (cb.checked) {
              item.classList.add("selected");
            } else {
              item.classList.remove("selected");
            }
          });
        updateSelectedCount();
      }

      function filterUrls() {
        const query = document
          .getElementById("filter-input")
          .value.toLowerCase();

        document.querySelectorAll(".url-item").forEach(item => {
          const text = item.textContent.toLowerCase();
          if (text.includes(query)) {
            item.classList.remove("hidden");
          } else {
            item.classList.add("hidden");
          }
        });
      }

      function updateSelectedCount() {
        const count = document.querySelectorAll(".checkbox:checked").length;
        document.getElementById("selected-urls").textContent = count;
        document.getElementById("selected-count").textContent =
          `${count} selected`;

        const scrapeBtn = document.getElementById("scrape-btn");
        scrapeBtn.disabled = count === 0;
      }

      function scrapeSelected() {
        const selectedUrls = [];
        document.querySelectorAll(".checkbox:checked").forEach(cb => {
          const index = cb.closest(".url-item").dataset.index;
          selectedUrls.push(allUrls[index].url);
        });

        if (selectedUrls.length === 0) {
          alert("No URLs selected");
          return;
        }

        // Copy URLs to clipboard for user to paste back to Claude
        const urlsList = selectedUrls.join("\n");
        navigator.clipboard
          .writeText(urlsList)
          .then(() => {
            alert(
              `âœ… ${selectedUrls.length} URLs copied to clipboard!\n\nGo back to Claude Code and say:\n"Scrape the copied URLs"`
            );
          })
          .catch(() => {
            // Fallback: show in alert
            alert(
              `Selected URLs:\n\n${urlsList}\n\nCopy these and tell Claude Code to scrape them.`
            );
          });
      }

      // Load data on page load
      window.onload = loadData;
    </script>
  </body>
</html>
